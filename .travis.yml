language: go

go:
  - 1.13.x

before_install:
  - go get -t -v ./...

script:
- go test -race -coverprofile=coverage.txt -covermode=atomic

after_success:
  - bash <(curl -s https://codecov.io/bash)

before_deploy:
  - "./_bin/build.sh darwin ${TRAVIS_TAG}"
  - "./_bin/build.sh linux ${TRAVIS_TAG}"

deploy:
  provider: releases
  api_key:
    secure: "$GITHUB_API_KEY"
  file:
    - "_dist/gomock_darwin_$TRAVIS_TAG"
    - "_dist/gomock_linux_$TRAVIS_TAG"
  skip_cleanup: true
  on:
    repo: smeshkov/gomock
    tags: true
