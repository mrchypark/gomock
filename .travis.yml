language: go

go:
  - 1.13.x

before_install:
  - go get -t -v ./...

script:
- go test -race -coverprofile=coverage.txt -covermode=atomic

after_success:
  - bash <(curl -s https://codecov.io/bash)

before_deploy:
  - "./_bin/build.sh darwin ${TRAVIS_TAG}"
  - "./_bin/build.sh linux ${TRAVIS_TAG}"

deploy:
  provider: releases
  api_key:
    secure: fT+8bb1nS67tT/jh66rRKLekqx7Q1t5DBNp3YevxeI50oeSPKvvIlxWM16M3BBBWuvBPGuWT8gLFWHLqe8nfUtcNnXV/i7fIlt95ocTLLjWdfZ0bTlzaGzGz24/ayljfWYegoU9f4w+V64EOvTdXH+Gdp9191bP8U5xKfQapiljaRa1p38Em0SQTjG/vjedAdhXgFgiHG2gFDGbyihHD3DD8ECZax2xw60BPoTrmsrEayn8hCYmmZ9RSs3KznhMNs+70hS2r/LU9/Awbvkz+XdTR9VB4hqBiymrrU0AtVJ1kWh2HuvHFrggqWmBVOxzPNUnT5chSTLmmz51KbHH72M42RfVDQPlkMFNUaZf6guPRLqZDlxcHcAma9EM/bjQUOsiwSIxoEObkgWo/3WzqAKKNEf9/l0T/h5iNhtvNOASfBXG83+P4RmC9UjOjvkxdLJw+gSUjjgk3ccfDqif3y3M9iaAQqlR02hRWnGc6RO0hmCYkzVlCNCy/V8UpnAgwSD4hcEF0RelwflnHted7ASrDfB8Y/SfTv1ij14oyCKunCMwMVBjGTWgAYb4kAZmTG2tP9vRQZdt5/rD5ZST9DrXH2hqQijkHRSSSRazLrCapazSSwyEtnVndvn08KQDqZRUqyC59nfW7CMcAmQWt24FpkItC0otGgAsdDYgwDJU=
  file:
    - "gomock_darwin_$TRAVIS_TAG"
    - "gomock_linux_$TRAVIS_TAG"
  skip_cleanup: true
  on:
    tags: true
